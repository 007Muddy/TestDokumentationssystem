<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Dokumentationssystem.Views"
             xmlns:converters="clr-namespace:Dokumentationssystem.Converters"
             x:Class="Dokumentationssystem.Views.InspectionDetailsPage"
             Title="Inspection Details">

    <!-- Page Resources -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Register the Base64 to Image converter -->
            <converters:Base64ToImageConverter x:Key="Base64ToImageConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="20" BackgroundColor="#F0F0F0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page Title -->
        <Label Text="Inspection Details" 
               FontSize="28" 
               FontAttributes="Bold" 
               HorizontalOptions="Center" 
               VerticalOptions="Start" 
               TextColor="#333" 
               Margin="10"/>

        <!-- Frame to display Inspection details -->
        <Frame Grid.Row="1" Padding="20" BackgroundColor="White" Margin="10" CornerRadius="12" HasShadow="True">
            <ScrollView>
                <VerticalStackLayout Spacing="20">

                    <Label Text="{Binding InspectionName, StringFormat='Inspection Name: {0}'}" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           TextColor="Black" />

                    <Label Text="{Binding CreatedBy, StringFormat='Created By: {0}'}" 
                           FontSize="18" 
                           TextColor="Black" />

                    <Label Text="{Binding Address, StringFormat='Address: {0}'}" 
                           FontSize="18" 
                           TextColor="Black" />

                    <Label Text="{Binding Date, StringFormat='Date: {0:dd MMM yyyy}'}" 
                           FontSize="18" 
                           TextColor="Black" />

                    <Label Text="Photos" FontSize="20" FontAttributes="Bold" TextColor="Black"/>

                    <CollectionView x:Name="PhotoCollectionView" 
                BackgroundColor="White"
                HeightRequest="350"
                ItemsSource="{Binding PhotoPaths}">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical" 
                         Span="3" 
                         VerticalItemSpacing="5" 
                         HorizontalItemSpacing="5" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BorderColor="Transparent" Padding="0" Margin="0" HasShadow="False" CornerRadius="0" BackgroundColor="White" WidthRequest="250" HeightRequest="250">
                                    <Image Source="{Binding ., Converter={StaticResource Base64ToImageConverter}}" 
                       HeightRequest="250" 
                       WidthRequest="250" 
                       Aspect="AspectFit">
                                        <!-- Add TapGestureRecognizer to handle image click -->
                                        <Image.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type local:InspectionDetailsPage}}, Path=TapImageCommand}" CommandParameter="{Binding .}" />
                                        </Image.GestureRecognizers>
                                    </Image>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>


                </VerticalStackLayout>
            </ScrollView>
        </Frame>
    </Grid>
</ContentPage>
